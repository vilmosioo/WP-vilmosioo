/*! VilmosIoo - v1.1.0 */THREE.TrackballControls=function(a,b){function c(a){l.enabled!==!1&&(window.removeEventListener("keydown",c),p=o,o===m.NONE&&(a.keyCode!==l.keys[m.ROTATE]||l.noRotate?a.keyCode!==l.keys[m.ZOOM]||l.noZoom?a.keyCode!==l.keys[m.PAN]||l.noPan||(o=m.PAN):o=m.ZOOM:o=m.ROTATE))}function d(){l.enabled!==!1&&(o=p,window.addEventListener("keydown",c,!1))}function e(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o===m.NONE&&(o=a.button),o!==m.ROTATE||l.noRotate?o!==m.ZOOM||l.noZoom?o!==m.PAN||l.noPan||(x=y=l.getMouseOnScreen(a.clientX,a.clientY)):t=u=l.getMouseOnScreen(a.clientX,a.clientY):r=s=l.getMouseProjectionOnBall(a.clientX,a.clientY),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1))}function f(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o!==m.ROTATE||l.noRotate?o!==m.ZOOM||l.noZoom?o!==m.PAN||l.noPan||(y=l.getMouseOnScreen(a.clientX,a.clientY)):u=l.getMouseOnScreen(a.clientX,a.clientY):s=l.getMouseProjectionOnBall(a.clientX,a.clientY))}function g(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o=m.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g))}function h(a){if(l.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),t.y+=.01*b}}function i(a){if(l.enabled!==!1)switch(a.touches.length){case 1:o=m.TOUCH_ROTATE,r=s=l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY);break;case 2:o=m.TOUCH_ZOOM;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;w=v=Math.sqrt(b*b+c*c);break;case 3:o=m.TOUCH_PAN,x=y=l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY);break;default:o=m.NONE}}function j(a){if(l.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:s=l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY);break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;w=Math.sqrt(b*b+c*c);break;case 3:y=l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY);break;default:o=m.NONE}}function k(a){if(l.enabled!==!1){switch(a.touches.length){case 1:r=s=l.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY);break;case 2:v=w=0;break;case 3:x=y=l.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY)}o=m.NONE}}var l=this,m={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var n=new THREE.Vector3,o=m.NONE,p=m.NONE,q=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector2,v=0,w=0,x=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var z={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.getMouseOnScreen=function(a,b){return new THREE.Vector2(.5*((a-l.screen.offsetLeft)/l.radius),.5*((b-l.screen.offsetTop)/l.radius))},this.getMouseProjectionOnBall=function(a,b){var c=new THREE.Vector3((a-.5*l.screen.width-l.screen.offsetLeft)/l.radius,(.5*l.screen.height+l.screen.offsetTop-b)/l.radius,0),d=c.length();d>1?c.normalize():c.z=Math.sqrt(1-d*d),q.copy(l.object.position).sub(l.target);var e=l.object.up.clone().setLength(c.y);return e.add(l.object.up.clone().cross(q).setLength(c.x)),e.add(q.setLength(c.z)),e},this.rotateCamera=function(){var a=Math.acos(r.dot(s)/r.length()/s.length());if(a){var b=(new THREE.Vector3).crossVectors(r,s).normalize(),c=new THREE.Quaternion;a*=l.rotateSpeed,c.setFromAxisAngle(b,-a),q.applyQuaternion(c),l.object.up.applyQuaternion(c),s.applyQuaternion(c),l.staticMoving?r.copy(s):(c.setFromAxisAngle(b,a*(l.dynamicDampingFactor-1)),r.applyQuaternion(c))}},this.zoomCamera=function(){if(o===m.TOUCH_ZOOM){var a=v/w;v=w,q.multiplyScalar(a)}else{var a=1+(u.y-t.y)*l.zoomSpeed;1!==a&&a>0&&(q.multiplyScalar(a),l.staticMoving?t.copy(u):t.y+=(u.y-t.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var a=y.clone().sub(x);if(a.lengthSq()){a.multiplyScalar(q.length()*l.panSpeed);var b=q.clone().cross(l.object.up).setLength(a.x);b.add(l.object.up.clone().setLength(a.y)),l.object.position.add(b),l.target.add(b),l.staticMoving?x=y:x.add(a.subVectors(y,x).multiplyScalar(l.dynamicDampingFactor))}},this.checkDistances=function(){l.noZoom&&l.noPan||(l.object.position.lengthSq()>l.maxDistance*l.maxDistance&&l.object.position.setLength(l.maxDistance),q.lengthSq()<l.minDistance*l.minDistance&&l.object.position.addVectors(l.target,q.setLength(l.minDistance)))},this.update=function(){q.subVectors(l.object.position,l.target),l.noRotate||l.rotateCamera(),l.noZoom||l.zoomCamera(),l.noPan||l.panCamera(),l.object.position.addVectors(l.target,q),l.checkDistances(),l.object.lookAt(l.target),n.distanceToSquared(l.object.position)>0&&(l.dispatchEvent(z),n.copy(l.object.position))},this.reset=function(){o=m.NONE,p=m.NONE,l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.up.copy(l.up0),q.subVectors(l.object.position,l.target),l.object.lookAt(l.target),l.dispatchEvent(z),n.copy(l.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",d,!1),this.handleResize()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);